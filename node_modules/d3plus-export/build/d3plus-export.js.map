{"version":3,"file":"d3plus-export.js","sources":["../src/svgPresets.js","../src/htmlPresets.js","../src/dom2canvas.js","../src/saveElement.js"],"sourcesContent":["/**\n    @function svgPresets\n    @desc Adds SVG default attributes to a d3 selection in order to render it properly.\n    @param {Selection} selection\n*/\nexport default function(selection) {\n\n  if (!selection || !selection.size()) return;\n\n  // sets \"stroke-width\" attribute to `0` if not defined\n  const strokeWidth = selection.attr(\"stroke-width\");\n  selection.attr(\"stroke-width\", !strokeWidth ? 0 : strokeWidth);\n\n  // if there is no stroke, set the stroke color to \"transparent\" (fixes weird text rendering)\n  if (!strokeWidth) selection.attr(\"stroke\", \"transparent\");\n\n  // sets \"fill\" attribute to black if not defined\n  const fill = selection.attr(\"fill\");\n  if (!fill && selection.node().tagName === \"text\") selection.attr(\"fill\", \"#000\");\n\n  // sets \"fill-opacity\" attribute to `0` if fill is \"transparent\" or \"none\"\n  const transparent = [\"none\", \"transparent\"].includes(selection.attr(\"fill\"));\n  const fillOpacity = selection.attr(\"fill-opacity\");\n  selection.attr(\"fill-opacity\", transparent ? 0 : fillOpacity);\n\n  // \"aria-label\" properties interfere with text labels ¯\\_(ツ)_/¯\n  selection.attr(\"aria-label\", null);\n\n  // sets NaN positions to zero\n  const x = selection.attr(\"x\");\n  if (x === \"NaN\") selection.attr(\"x\", \"0px\");\n  const y = selection.attr(\"y\");\n  if (y === \"NaN\") selection.attr(\"y\", \"0px\");\n\n  // fixed relative URLs for SVG downloads\n  const url = selection.attr(\"xlink:href\");\n  if (url && typeof window !== \"undefined\" && url.charAt(0) === \"/\") {\n    selection.attr(\"xlink:href\", `${window.location.origin}${url}`);\n  }\n\n}\n","import {select} from \"d3-selection\";\n\n/**\n    @function htmlPresets\n    @desc Adds HTML default styles to a d3 selection in order to render it properly.\n    @param {Selection} selection\n*/\nexport default function(selection) {\n\n  selection.selectAll(\"*\")\n    .each(function() {\n      const tag = this.tagName.toLowerCase();\n      if (![\"option\"].includes(tag)) {\n\n        const elem = select(this);\n\n        /* forces minor unnoticible letter-spacing on any element where it is not defined to fix IE */\n        const letterSpacing = elem.style(\"letter-spacing\");\n        elem.style(\"letter-spacing\", letterSpacing === \"normal\" ? \"0.1px\" : letterSpacing);\n\n      }\n    });\n\n}\n","import html2canvas from \"html2canvas\";\nimport canvg from \"canvg-browser\";\nimport {select, selectAll} from \"d3-selection\";\n\nimport svgPresets from \"./svgPresets\";\nimport htmlPresets from \"./htmlPresets\";\n\nconst defaultOptions = {\n  background: false,\n  callback: () => {},\n  exclude: [],\n  padding: 0,\n  scale: 1\n};\n\nconst canvgOptions = {\n  ignoreMouse: true,\n  ignoreAnimation: true,\n  ignoreDimensions: true,\n  ignoreClear: true\n};\n\n/**\n    @function parseTransform\n    @desc Extracts scale, x, and y position from an elements \"transform\" attribute, respecting cross-browser render differences.\n    @param {HTMLElement} elem The element to be analyzed.\n    @private\n*/\nfunction parseTransform(elem) {\n\n  const property = select(elem).attr(\"transform\");\n  let scale = 1, x = 0, y = 0;\n  if (property) {\n    scale = property.match(/scale\\(([^a-z]+)\\)/i);\n    if (scale) scale = parseFloat(scale[1]);\n    else scale = 1;\n    const translate = property.match(/translate\\(([^a-z]+)\\)/i);\n    if (translate) {\n      [x, y] = translate[1]\n        .replace(\", \", \",\")\n        .replace(/([^a-z]),*\\s([^a-z])/gi, \"$1,$2\")\n        .split(\",\")\n        .map(d => parseFloat(d) * scale);\n    }\n  }\n  return [scale, x, y];\n\n}\n\n/**\n    @function dom2canvas\n    @desc Renders HTML/SVG elements to a shared canvas.\n    @param {HTMLElement|Object|Array} elem The element or array of elements to be rendered to a single canvas. Additionally, a complex object can be passed as an element which can contain specific other properties.\n    @param {Number} [elem.x] The x offset of the element within the rendered canvas.\n    @param {Number} [elem.y] The y offset of the element within the rendered canvas.\n    @param {Object} [options] Additional options to specify.\n    @param {String} [options.background] Background color of the rendered canvas.\n    @param {Function} [options.callback] Callback function to be passed the canvas element after rendering.\n    @param {HTMLElement} [options.canvas] A canvas DOM element to draw onto. If no element is supplied, a canvas element will be created in memory and passed to the callback function when drawing is complete.\n    @param {Array} [options.excludes] An array of HTMLElement objects to be excluded from the render.\n    @param {Number} [options.height] Pixel height for the final output. If a height value has not been passed, it will be inferred from the sizing of the first DOM element passed.\n    @param {Number} [options.padding = 0] Outer padding for the final file.\n    @param {Number} [options.scale = 1] Scale for the final file.\n    @param {Number} [options.width] Pixel width for the final output. If a width value has not been passed, it will be inferred from the sizing of the first DOM element passed.\n*/\nexport default function(elem, options) {\n\n  if (!elem) return;\n  if (!(elem instanceof Array)) elem = [elem];\n\n  options = Object.assign({}, defaultOptions, options);\n  const IE = new RegExp(/(MSIE|Trident\\/|Edge\\/)/i).test(navigator.userAgent);\n  const ratio = window ? window.devicePixelRatio || 1 : 1;\n\n  let reference = elem[0];\n  if (reference.constructor === Object) reference = reference.element;\n\n  const height = options.height ||\n          parseFloat(select(reference).style(\"height\")) +\n          parseFloat(select(reference).style(\"padding-top\")) +\n          parseFloat(select(reference).style(\"padding-bottom\")),\n        width = options.width ||\n          parseFloat(select(reference).style(\"width\")) +\n          parseFloat(select(reference).style(\"padding-left\")) +\n          parseFloat(select(reference).style(\"padding-right\"));\n\n  let layerX, layerY, offsetX = 0, offsetY = 0;\n  if (reference.getBoundingClientRect) {\n    const bounds = reference.getBoundingClientRect();\n    offsetX = bounds.left;\n    offsetY = bounds.top;\n  }\n  else {\n    offsetX = reference.offsetLeft;\n    offsetY = reference.offsetTop;\n  }\n\n  const canvas = options.canvas || document.createElement(\"canvas\");\n  canvas.width = (width + options.padding * 2) * options.scale * ratio;\n  canvas.height = (height + options.padding * 2) * options.scale * ratio;\n  canvas.style.width = (width + options.padding * 2) * options.scale;\n  canvas.style.height = (height + options.padding * 2) * options.scale;\n\n  const context = canvas.getContext(\"2d\");\n  context.scale(options.scale * ratio, options.scale * ratio);\n  context.clearRect(0, 0, canvas.width / ratio, canvas.height / ratio);\n\n  if (options.background) {\n    context.beginPath();\n    context.rect(0, 0, canvas.width / ratio, canvas.height / ratio);\n    context.fillStyle = options.background;\n    context.fill();\n  }\n\n  const layers = [];\n\n  /**\n   * Determines how a given DOM element should be rendered.\n   * @param {Object} trans ancestral transform properties\n   * @private\n   */\n  function checkRender(trans) {\n\n    const tag = (this.tagName || \"\").toLowerCase();\n    if (options.exclude.includes(this) || tag === \"foreignobject\") return;\n\n    const transform = Object.assign({}, trans);\n\n    // strips translate and scale from transform property\n    if (this.tagName) {\n\n      const opacity = select(this).attr(\"opacity\") || select(this).style(\"opacity\");\n      const display = select(this).style(\"display\");\n      const visibility = select(this).style(\"visibility\");\n      if (display === \"none\" || visibility === \"hidden\" || opacity && parseFloat(opacity) === 0) return;\n\n      const tag = this.tagName.toLowerCase();\n\n      if (tag.length && [\"defs\", \"title\", \"desc\"].includes(tag)) return;\n\n      if (tag === \"svg\") {\n\n        // do not perform this transform for SVGs nested within other SVGs\n        if (!transform.svg) {\n          const {left, top} = this.getBoundingClientRect();\n          transform.x += left - offsetX;\n          transform.y += top - offsetY;\n          transform.svg = true;\n        }\n\n        let x = select(this).attr(\"x\");\n        x = x ? parseFloat(x) * transform.scale : 0;\n        transform.x += x;\n        let y = select(this).attr(\"y\");\n        y = y ? parseFloat(y) * transform.scale : 0;\n        transform.y += y;\n        transform.clip = {\n          height: parseFloat(select(this).attr(\"height\") || select(this).style(\"height\")),\n          width: parseFloat(select(this).attr(\"width\") || select(this).style(\"width\")),\n          x, y\n        };\n      }\n      else {\n        const x = select(this).attr(\"x\");\n        if (x) transform.x += parseFloat(x) * transform.scale;\n        const y = select(this).attr(\"y\");\n        if (y) transform.y += parseFloat(y) * transform.scale;\n      }\n\n    }\n\n    if (!tag.length) {\n      const test = (this.wholeText || \"\").replace(/\\s/g, \"\");\n      if (test.length) {\n\n        const text = this.nodeValue\n          .replace(/^\\s*/, \"\")\n          .replace(/^\\n/, \"\")\n          .replace(/^\\s*/, \"\")\n          .replace(/\\n$/, \"\")\n          .replace(/\\s*$/, \"\")\n          .replace(/\\n$/, \"\");\n\n        layers.push({type: \"text\", style: this.parentNode, value: text, x: transform.x, y: transform.y});\n\n      }\n    }\n    else if (tag === \"text\") {\n      const elem = this.cloneNode(true);\n      select(elem).call(svgPresets);\n      layers.push(Object.assign({}, transform, {type: \"svg\", value: elem}));\n    }\n    else if ([\"image\", \"img\"].includes(tag)) {\n\n      const url = select(this).attr(\"href\") || select(this).attr(\"xlink:href\");\n\n      if (url.length) {\n\n        const h = parseFloat(select(this).attr(\"height\")) * transform.scale,\n              w = parseFloat(select(this).attr(\"width\")) * transform.scale;\n\n        const data = {\n          clip: transform.clip,\n          height: h,\n          loaded: false,\n          type: \"img\",\n          width: w,\n          x: transform.x,\n          y: transform.y\n        };\n        layers.push(data);\n\n        const img = new Image();\n        img.crossOrigin = \"Anonymous\";\n        img.onload = function() {\n\n          const canvas2 = document.createElement(\"canvas\");\n          const ctx2 = canvas2.getContext(\"2d\");\n          canvas2.height = h * ratio;\n          canvas2.width = w * ratio;\n          ctx2.drawImage(this, 0, 0, w * ratio, h * ratio);\n          const himg = document.createElement(\"img\");\n          himg.src = canvas2.toDataURL(\"image/png\");\n\n          data.value = himg;\n          data.loaded = true;\n\n        };\n        img.onerror = function() {\n          data.loaded = true;\n          data.value = false;\n        };\n        img.src = url;\n\n      }\n\n    }\n    else if (![\"svg\", \"g\", \"text\"].includes(tag) && !select(this).selectAll(\"svg\").size()) {\n\n      const s = options.scale * ratio;\n\n      const data = {\n        height: Math.floor(height + options.padding * 2 + offsetY),\n        loaded: false,\n        type: \"html\",\n        width: Math.floor(width + options.padding * 2 + offsetX),\n        x: Math.floor(layerX - offsetX),\n        y: Math.floor(layerY - offsetY)\n      };\n\n      const tempCanvas = document.createElement(\"canvas\");\n      tempCanvas.width = data.width * s;\n      tempCanvas.height = data.height * s;\n      tempCanvas.style.width = `${data.width * s}px`;\n      tempCanvas.style.height = `${data.height * s}px`;\n\n      const tempContext = tempCanvas.getContext(\"2d\");\n      tempContext.scale(s, s);\n\n      layers.push(data);\n\n      htmlPresets(select(this));\n\n      html2canvas(this, {\n        allowTaint: true,\n        canvas: tempCanvas,\n        letterRendering: true\n      }).then(c => {\n        data.value = c;\n        data.loaded = true;\n      });\n\n    }\n    else if (tag !== \"svg\" && this.childNodes.length > 0 && !select(this).selectAll(\"image, img, svg\").size()) {\n\n      const elem = this.cloneNode(true);\n      select(elem).selectAll(\"*\").each(function() {\n        select(this).call(svgPresets);\n        if (select(this).attr(\"opacity\") === \"0\") this.parentNode.removeChild(this);\n      });\n\n      layers.push(Object.assign({}, transform, {type: \"svg\", value: elem, tag}));\n\n    }\n    else if (this.childNodes.length > 0) {\n      const [scale, x, y] = parseTransform(this);\n      transform.scale *= scale;\n      transform.x += x;\n      transform.y += y;\n      checkChildren(this, transform);\n    }\n    else { // catches all SVG shapes\n\n      const elem = this.cloneNode(true);\n      select(elem).selectAll(\"*\").each(function() {\n        if (select(this).attr(\"opacity\") === \"0\") this.parentNode.removeChild(this);\n      });\n\n      if (tag === \"line\") {\n        select(elem).attr(\"x1\", parseFloat(select(elem).attr(\"x1\")) + transform.x);\n        select(elem).attr(\"x2\", parseFloat(select(elem).attr(\"x2\")) + transform.x);\n        select(elem).attr(\"y1\", parseFloat(select(elem).attr(\"y1\")) + transform.y);\n        select(elem).attr(\"y2\", parseFloat(select(elem).attr(\"y2\")) + transform.y);\n      }\n      else if (tag === \"path\") {\n        const [scale, x, y] = parseTransform(elem);\n        if (select(elem).attr(\"transform\")) select(elem).attr(\"transform\", `scale(${scale})translate(${x + transform.x},${y + transform.y})`);\n      }\n      select(elem).call(svgPresets);\n\n      const fill = select(elem).attr(\"fill\");\n      const defFill = fill && fill.indexOf(\"url\") === 0;\n      // if (defFill) select(elem).attr(\"fill-opacity\", 0);\n\n      layers.push(Object.assign({}, transform, {type: \"svg\", value: elem, tag}));\n      if (defFill) {\n        const def = select(fill.slice(4, -1)).node().cloneNode(true);\n        const defTag = (def.tagName || \"\").toLowerCase();\n        if (defTag === \"pattern\") {\n\n          const [scale, x, y] = parseTransform(elem);\n          transform.scale *= scale;\n          transform.x += x;\n          transform.y += y;\n          checkChildren(def, transform);\n\n        }\n      }\n\n    }\n\n  }\n\n  /**\n   * Performs \"checkRender\" on all childNodes of a DOM element (used recursively by checkRender)\n   * @param {HTMLElement} e DOM node to traverse\n   * @param {Object} trans ancestral transform properties\n   * @private\n   */\n  function checkChildren(e, trans) {\n    selectAll(e.childNodes).each(function() {\n      checkRender.bind(this)(trans);\n    });\n  }\n\n  for (let i = 0; i < elem.length; i++) {\n\n    let e = elem[i],\n        options = {scale: 1, x: 0, y: 0, svg: false};\n\n    if (e.constructor === Object) {\n      options = Object.assign(options, e);\n      e = e.element;\n    }\n    layerX = options.x;\n    layerY = options.y;\n    checkRender.bind(e)(options);\n\n  }\n\n  /**\n   * Checks the status of each render layer every 500ms, and finishes render once all are complete.\n   * @private\n   */\n  function checkStatus() {\n\n    let allDone = true;\n    for (let i = 0; i < layers.length; i++) {\n      if (layers[i].loaded === false) {\n        allDone = false;\n        break;\n      }\n    }\n\n    if (allDone) finish();\n    else setTimeout(checkStatus, 500);\n\n  }\n\n  checkStatus();\n\n  /**\n   * Finishes the render after all layers have been rendered to canvas.\n   * @private\n   */\n  function finish() {\n\n    for (let i = 0; i < layers.length; i++) {\n\n      const layer = layers[i];\n      const clip = layer.clip || {height, width, x: 0, y: 0};\n\n      switch (layer.type) {\n\n        case \"img\":\n          if (layer.value) {\n            context.save();\n            context.beginPath();\n            context.translate(options.padding + clip.x, options.padding + clip.y);\n            context.rect(0, 0, clip.width, clip.height);\n            context.clip();\n            context.drawImage(layer.value, layer.x + clip.x, layer.y + clip.y, layer.width, layer.height);\n            context.restore();\n          }\n          break;\n\n        case \"html\":\n          context.save();\n          context.beginPath();\n          context.translate(options.padding, options.padding);\n          context.drawImage(layer.value, layer.x, layer.y, layer.width, layer.height);\n          context.restore();\n          break;\n\n        case \"text\":\n\n          const parent = select(layer.style);\n          const title = layer.value\n            .replace(/&/g, \"&amp;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n\n          const fC = parent.style(\"color\"),\n                fS = parent.style(\"font-size\");\n\n          let fF = parent.style(\"font-family\").split(\",\")[0];\n\n          if (fF.indexOf(\"'\") !== 0) fF = `'${fF}'`;\n          const text = `<text stroke='none' dy='${fS}' fill='${fC}' font-family=${fF} font-size='${fS}'>${title}</text>`;\n\n          context.save();\n          context.translate(options.padding, options.padding);\n          canvg(canvas, text, Object.assign({}, canvgOptions, {offsetX: layer.x, offsetY: layer.y}));\n          context.restore();\n\n          break;\n\n        case \"svg\":\n          const outer = IE ? new XMLSerializer().serializeToString(layer.value) : layer.value.outerHTML;\n          context.save();\n          context.translate(options.padding + clip.x + layer.x, options.padding + clip.y + layer.y);\n          context.rect(0, 0, clip.width, clip.height);\n          context.clip();\n          canvg(canvas, outer, Object.assign({}, canvgOptions, {offsetX: layer.x + clip.x, offsetY: layer.y + clip.y}));\n          context.restore();\n          break;\n\n        default:\n          console.warn(\"uncaught\", layer);\n          break;\n\n      }\n\n    }\n\n    options.callback(canvas);\n\n  }\n\n}\n","import \"canvas-toBlob\";\nimport {select} from \"d3-selection\";\nimport {saveAs} from \"file-saver\";\n// import JsPDF from \"jspdf\";\n\nimport dom2canvas from \"./dom2canvas\";\nimport svgPresets from \"./svgPresets\";\n\nconst defaultOptions = {\n  filename: \"download\",\n  type: \"png\"\n};\n\n/**\n    @function saveElement\n    @desc Downloads an HTML Element as a bitmap PNG image.\n    @param {HTMLElement|Array} elem A single element or array of elements to be saved to one file.\n    @param {Object} [options] Additional options to specify.\n    @param {String} [options.filename = \"download\"] Filename for the downloaded file, without the extension.\n    @param {String} [options.type = \"png\"] File type of the saved document. Accepted values are `\"png\"` and `\"jpg\"`.\n    @param {Function} [options.callback] Function to be invoked after saving is complete.\n    @param {Object} [renderOptions] Custom options to be passed to the dom2canvas function.\n*/\nexport default function(elem, options = {}, renderOptions = {}) {\n\n  if (!elem) return;\n  options = Object.assign({}, defaultOptions, options);\n\n  const IE = new RegExp(/(MSIE|Trident\\/|Edge\\/)/i).test(navigator.userAgent);\n\n  if (!(elem instanceof Array) && options.type === \"svg\") {\n    const clone = elem.cloneNode(true);\n    select(clone).call(svgPresets);\n    select(clone).selectAll(\"*\").each(function() {\n      select(this).call(svgPresets);\n    });\n    const outer = IE ? new XMLSerializer().serializeToString(clone) : clone.outerHTML;\n    saveAs(new Blob([outer], {type: \"application/svg+xml\"}), `${options.filename}.svg`);\n\n    if (options.callback) options.callback();\n\n  }\n  else {\n\n    dom2canvas(elem, Object.assign({}, renderOptions, {callback: canvas => {\n\n      if ([\"jpg\", \"png\"].includes(options.type)) {\n        canvas.toBlob(blob => saveAs(blob, `${options.filename}.${options.type}`));\n      }\n      // else if (options.type === \"pdf\") {\n\n      //   const outputHeight = 11,\n      //         outputWidth = 8.5;\n\n      //   const aspect = canvas.width / canvas.height,\n      //         orientation = aspect > 1 ? \"landscape\" : \"portrait\";\n\n      //   const pdf = new JsPDF({\n      //     orientation,\n      //     unit: \"in\",\n      //     format: [outputWidth, outputHeight]\n      //   });\n\n      //   let h = orientation === \"landscape\" ? outputWidth : outputHeight,\n      //       left,\n      //       top,\n      //       w = orientation === \"landscape\" ? outputHeight : outputWidth;\n\n      //   const margin = 0.5;\n\n      //   if (aspect < w / h) {\n      //     h -= margin * 2;\n      //     const tempWidth = h * aspect;\n      //     top = margin;\n      //     left = (w - tempWidth) / 2;\n      //     w = tempWidth;\n      //   }\n      //   else {\n      //     w -= margin * 2;\n      //     const tempHeight = w / aspect;\n      //     left = margin;\n      //     top = (h - tempHeight) / 2;\n      //     h = tempHeight;\n      //   }\n\n      //   pdf.addImage(canvas, \"canvas\", left, top, w, h);\n      //   pdf.save(options.filename);\n\n      // }\n\n      if (options.callback) options.callback();\n\n    }}));\n\n  }\n\n}\n"],"names":["svgPresets","selection","size","strokeWidth","attr","fill","node","tagName","transparent","includes","fillOpacity","x","y","url","window","charAt","location","origin","htmlPresets","selectAll","each","tag","toLowerCase","elem","select","letterSpacing","style","defaultOptions","background","callback","exclude","padding","scale","canvgOptions","ignoreMouse","ignoreAnimation","ignoreDimensions","ignoreClear","parseTransform","property","match","parseFloat","translate","replace","split","map","d","dom2canvas","options","Array","Object","assign","IE","RegExp","test","navigator","userAgent","ratio","devicePixelRatio","reference","constructor","element","height","width","layerX","layerY","offsetX","offsetY","getBoundingClientRect","bounds","left","top","offsetLeft","offsetTop","canvas","document","createElement","context","getContext","clearRect","beginPath","rect","fillStyle","layers","checkRender","trans","transform","opacity","display","visibility","length","svg","clip","wholeText","text","nodeValue","push","type","parentNode","value","cloneNode","call","h","w","data","loaded","img","Image","crossOrigin","onload","canvas2","ctx2","drawImage","himg","src","toDataURL","onerror","s","Math","floor","tempCanvas","tempContext","html2canvas","allowTaint","letterRendering","then","c","childNodes","removeChild","checkChildren","defFill","indexOf","def","slice","defTag","e","bind","i","checkStatus","allDone","finish","setTimeout","layer","save","restore","parent","title","fC","fS","fF","canvg","outer","XMLSerializer","serializeToString","outerHTML","console","warn","filename","saveElement","renderOptions","clone","saveAs","Blob","toBlob","blob"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}